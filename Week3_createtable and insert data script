-- table creation in oracle.
drop table  employee cascade constraint ;
drop table customer cascade constraint ;
drop table resourcetbl cascade constraint ;
drop table Facility cascade constraint ;
drop table location cascade constraint ;
drop table eventrequest cascade constraint ;
drop table eventplan cascade constraint ;
drop table eventplanline cascade constraint ;


CREATE TABLE Employee
(
    empNo CHAR(8) NOT NULL,
    empName VARCHAR2(35) NOT NULL,
    empDepartment VARCHAR2(25) NOT NULL,
    empPhone CHAR(10) NOT NULL,
    empEmail VARCHAR2(30) NOT NULL,
    CONSTRAINT PK_empNo PRIMARY KEY (EmpNo)
);


CREATE TABLE Customer
(
    custNo CHAR(8) NOT NULL,
    custName VARCHAR2 (30) NOT NULL,
    custAddress VARCHAR2(50) NOT NULL,
    custInternal CHAR(1) NOT NULL,
    custContact VARCHAR2(35) NOT NULL,
    custPhone CHAR(11) NOT NULL,
    custCity VARCHAR2(30) NOT NULL,
    custState CHAR(2) NOT NULL,
    custZip CHAR(10) NOT NULL,           
    CONSTRAINT PK_custNo PRIMARY KEY (custNo)
);

CREATE TABLE ResourceTbl
(
    resNo CHAR(8) NOT NULL,
    resName VARCHAR2 (30) NOT NULL,
    resRate DECIMAL(4,2) NOT NULL,
    CONSTRAINT check_resRate_ResourceTbl CHECK (resRate > 0),
    CONSTRAINT PK_ResNo PRIMARY KEY (ResNo)
);

CREATE TABLE Facility
(
    facNo CHAR(8) NOT NULL,
    facName VARCHAR2(30) NOT NULL,
    CONSTRAINT uniqueName UNIQUE (facName),
    CONSTRAINT PK_facNo PRIMARY KEY (facNo)
);



CREATE TABLE Location
(
    locNo CHAR(8) NOT NULL,
    facNo CHAR(8) NOT NULL,
    locName VARCHAR2(30) NOT NULL,
    CONSTRAINT PK_locNo PRIMARY KEY (locNo),
    CONSTRAINT FK_facNo_Location FOREIGN KEY (facNo) REFERENCES Facility
);

CREATE TABLE EventRequest  
(  
    eventNo CHAR(8) NOT NULL,  
    dateHeld DATE NOT NULL,  
    dateReq DATE NOT NULL,  
    facNo CHAR(8) NOT NULL,  
    custNo CHAR(8) NOT NULL,  
    dateAuth DATE,  
    status VARCHAR2(20) NOT NULL,  
    estCost DECIMAL(7,2) NOT NULL,  
    estAudience INTEGER NOT NULL, 
    budNo CHAR(8),  
    CONSTRAINT check_estAudience_EventRequest CHECK (estAudience > 0), 
    CONSTRAINT check_status_EventRequest CHECK (status IN ('Approved', 'Pending', 'Denied')), 
    CONSTRAINT FK_custNo_EventRequest FOREIGN KEY (custNo) REFERENCES Customer,    
    CONSTRAINT PK_eventNo PRIMARY KEY (eventNo)  
);

CREATE TABLE EventPlan  
(  
    planNo CHAR(8) NOT NULL,  
    eventNo CHAR(8) NOT NULL,  
    workDate DATE NOT NULL,  
    notes VARCHAR2(100),  
    activity VARCHAR2(50) NOT NULL,  
    empNo CHAR(8),  
    CONSTRAINT FK_eventNo_EventPlan FOREIGN KEY (eventNo) REFERENCES EventRequest,    
    CONSTRAINT PK_planNo PRIMARY KEY (planNo)  
);

CREATE TABLE EventPlanLine  
(  
    lineNo INTEGER NOT NULL,
    planNo CHAR(8) NOT NULL,  
    timeStart DATE NOT NULL,  
    timeEnd DATE NOT NULL,  
    numberFld INTEGER NOT NULL,  
    locNo CHAR(8) NOT NULL,  
    resNo CHAR(8) NOT NULL,
    CONSTRAINT check_timeStart_EventPlanLine CHECK (timeStart < timeEnd),    
    CONSTRAINT FK_locNo_EventPlanLine FOREIGN KEY (locNo) REFERENCES Location, 
    CONSTRAINT FK_resNo_EventPlanLine FOREIGN KEY (resNo) REFERENCES ResourceTbl,
    CONSTRAINT FK_planNo_EventPlanLine FOREIGN KEY (planNo) REFERENCES EventPlan,
    CONSTRAINT PK_planNo_lineNo_EventPlanLine PRIMARY KEY (planNo, lineNo) 
);
